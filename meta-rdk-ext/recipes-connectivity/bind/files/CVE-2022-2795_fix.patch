Date: Sep 01, 2023
From: e2014ba9e3b4236b0384ba17abfb2c9a155412f6
Subject: Patch bind to address CVE-2022-2795
Source:  GITLAB https://gitlab.isc.org/isc-projects/bind9/-/commit/e2014ba9e3b4236b0384ba17abfb2c9a155412f6
License:
Upstream-Status: Pending
Signed-off-by: kmarim851 <Kalidoss_Marimuthu@comcast.com>
---
Index: bind-9.11.19/lib/dns/resolver.c
===================================================================
--- bind-9.11.19.orig/lib/dns/resolver.c
+++ bind-9.11.19/lib/dns/resolver.c
@@ -179,6 +179,12 @@
  */
 #define NS_FAIL_LIMIT 4
 #define NS_RR_LIMIT   5
+/*
+ * IP address lookups are performed for at most NS_PROCESSING_LIMIT NS RRs in
+ * any NS RRset encountered, to avoid excessive resource use while processing
+ * large delegations.
+ */
+#define NS_PROCESSING_LIMIT 20
 
 /* Number of hash buckets for zone counters */
 #ifndef RES_DOMAIN_BUCKETS
@@ -3283,6 +3289,7 @@ fctx_getaddresses(fetchctx_t *fctx, bool
 	bool need_alternate = false;
 	bool all_spilled = true;
 	unsigned int no_addresses = 0;
+	unsigned int ns_processed = 0;
 
 	FCTXTRACE5("getaddresses", "fctx->depth=", fctx->depth);
 
@@ -3468,6 +3475,11 @@ fctx_getaddresses(fetchctx_t *fctx, bool
 
 		dns_rdata_reset(&rdata);
 		dns_rdata_freestruct(&ns);
+
+		if (++ns_processed >= NS_PROCESSING_LIMIT) {
+			result = ISC_R_NOMORE;
+			break;
+		}
 	}
 	if (result != ISC_R_NOMORE) {
 		return (result);
