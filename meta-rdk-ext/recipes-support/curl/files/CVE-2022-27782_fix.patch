Date: 26-June-2023
From: Kalidoss_Marimuthu@comcast.com
Source: Backport

See https://github.com/curl/curl/commit/1645e9b44505abd5cbaf65d

Index: curl-7.69.1/lib/url.c
===================================================================
--- curl-7.69.1.orig/lib/url.c
+++ curl-7.69.1/lib/url.c
@@ -1025,6 +1025,13 @@ static void prune_dead_connections(struc
   }
 }
 
+static bool ssh_config_matches(struct connectdata *one,
+		               struct connectdata *two)
+{
+  return (Curl_safecmp(one->proto.sshc.rsa, two->proto.sshc.rsa) &&
+          Curl_safecmp(one->proto.sshc.rsa_pub, two->proto.sshc.rsa_pub));
+}
+
 /*
  * Given one filled in connection struct (named needle), this function should
  * detect if there already is one that has all the significant details
@@ -1256,6 +1263,12 @@ ConnectionExists(struct Curl_easy *data,
         }
       }
 
+      if(get_protocol_family(needle->handler) == PROTO_FAMILY_SSH) {
+	 if(!ssh_config_matches(needle, check))
+            continue;
+      }
+
+
       if(!needle->bits.httpproxy || (needle->handler->flags&PROTOPT_SSL) ||
          needle->bits.tunnel_proxy) {
         /* The requested connection does not use a HTTP proxy or it uses SSL or
Index: curl-7.69.1/lib/vssh/ssh.h
===================================================================
--- curl-7.69.1.orig/lib/vssh/ssh.h
+++ curl-7.69.1/lib/vssh/ssh.h
@@ -7,7 +7,7 @@
  *                            | (__| |_| |  _ <| |___
  *                             \___|\___/|_| \_\_____|
  *
- * Copyright (C) 1998 - 2020, Daniel Stenberg, <daniel@haxx.se>, et al.
+ * Copyright (C) 1998 - 2022, Daniel Stenberg, <daniel@haxx.se>, et al.
  *
  * This software is licensed as described in the file COPYING, which
  * you should have received as part of this distribution. The terms
@@ -120,8 +120,8 @@ struct ssh_conn {
 
   /* common */
   const char *passphrase;     /* pass-phrase to use */
-  char *rsa_pub;              /* path name */
-  char *rsa;                  /* path name */
+  char *rsa_pub;              /* strdup'ed public key file */
+  char *rsa;                  /* strdup'ed private key file */
   bool authed;                /* the connection has been authenticated fine */
   sshstate state;             /* always use ssh.c:state() to change state! */
   sshstate nextstate;         /* the state to goto after stopping */
