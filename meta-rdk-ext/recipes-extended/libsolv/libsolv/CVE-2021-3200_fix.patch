Date: Mon, 28 AUg 2023
From: Alluri Revathi Bhavani <RevathiBhavani_Alluri@comcast.com>
Source: upstream
        https://github.com/openSUSE/libsolv/commit/0077ef29eb46d2e1df2f230fc95a1d9748d49dec 
CVE: CVE-2021-3200
CVE: CVE-2021-33928
CVE: CVE-2021-33929
CVE: CVE-2021-33930
CVE: CVE-2021-33938
CVE: CVE-2021-44568
Index: git/ext/testcase.c
===================================================================
--- git.orig/ext/testcase.c
+++ git/ext/testcase.c
@@ -1977,6 +1977,7 @@ testcase_read(Pool *pool, FILE *fp, cons
   Id *genid = 0;
   int ngenid = 0;
   Queue autoinstq;
+  int oldjobsize = job ? job->count : 0;
 
   if (resultp)
     *resultp = 0;
@@ -2051,6 +2052,21 @@ testcase_read(Pool *pool, FILE *fp, cons
 	  int prio, subprio;
 	  const char *rdata;
 
+	  if (pool->considered)
+	  {
+              pool_error(pool, 0, "testcase_read: cannot add repos after packages were disabled");
+	      continue;
+	  }
+	  if (solv)
+	  {
+              pool_error(pool, 0, "testcase_read: cannot add repos after the solver was created");
+              continue;
+	  }
+	  if (job && job->count != oldjobsize)
+	  {
+              pool_error(pool, 0, "testcase_read: cannot add repos after jobs have been created");
+	      continue;
+	  }
 	  prepared = 0;
           if (!poolflagsreset)
 	    {
@@ -2111,6 +2127,11 @@ testcase_read(Pool *pool, FILE *fp, cons
 	  int i;
 
 	  /* must set the disttype before the arch */
+	  if (job && job->count != oldjobsize)
+	  {
+	      pool_error(pool, 0, "testcase_read: cannot change the system after jobs have been created");
+	      continue;
+	  }
 	  prepared = 0;
 	  if (strcmp(pieces[2], "*") != 0)
 	    {
