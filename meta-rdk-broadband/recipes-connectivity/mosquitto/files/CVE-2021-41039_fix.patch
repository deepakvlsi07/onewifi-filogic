Date: 09-June-2023
From: Kalidoss_Marimuthu@comcast.com
Source: Backport

See bugzillaattachments.eclipsecontent.org/bugs/attachment.cgi?id=286914 

Index: mosquitto-1.6.12/lib/property_mosq.c
===================================================================
--- mosquitto-1.6.12.orig/lib/property_mosq.c
+++ mosquitto-1.6.12/lib/property_mosq.c
@@ -878,14 +878,15 @@ int mosquitto_property_check_all(int com
 		if(rc) return rc;
 
 		/* Check for duplicates */
-		tail = p->next;
-		while(tail){
-			if(p->identifier == tail->identifier
-					&& p->identifier != MQTT_PROP_USER_PROPERTY){
-
-				return MOSQ_ERR_DUPLICATE_PROPERTY;
+		if(p->identifier != MQTT_PROP_USER_PROPERTY){
+			tail = p->next;
+			while(tail){
+				if(p->identifier == tail->identifier
+						&& p->identifier != MQTT_PROP_USER_PROPERTY){
+					return MOSQ_ERR_DUPLICATE_PROPERTY;
+				}
+				tail = tail->next;
 			}
-			tail = tail->next;
 		}
 
 		p = p->next;
